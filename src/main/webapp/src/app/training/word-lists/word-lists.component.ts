import { Component, OnInit } from '@angular/core';
import { WordListsService } from './word-lists.service';
import { forkJoin } from 'rxjs';
import { map } from 'rxjs/operators';
import { WordList } from '../training.interface';
import * as lodash from 'lodash';
import { Router } from '@angular/router';

@Component({
  selector: 'app-word-lists',
  templateUrl: './word-lists.component.html',
  styleUrls: ['./word-lists.component.scss']
})
export class WordListsComponent implements OnInit {

  wordLists: Array<string>;
  importedWordLists: Array<WordList>;
  toPractice: Array<String> = new Array();

  constructor(private wordListsService: WordListsService,
    private route: Router) { }

  ngOnInit() {
    forkJoin(
      this.wordListsService.getWordLists(),
      this.wordListsService.getImportedWordLists()
    ).pipe(map(([wordLists, importedWordLists]) => {
      this.wordLists = wordLists;
      this.importedWordLists = importedWordLists;
    })).subscribe();
  }

  import(listName: string) {
    this.wordListsService.import(listName)
  }

  isImported(listName: string) {
    return !!lodash.find(this.importedWordLists, list => list.name === listName);
  }

  removeFileExtension(fineName: string) {
    return fineName.slice(0, -4);//extension is always .csv
  }

  onToPracticeChange(e: any) {
    const listName = e.target.value;
    if (e.target.checked) {
      if (!lodash.find(this.toPractice, list => list === listName)) {
        this.toPractice.push(listName)
      }
    } else {
      lodash.remove(this.toPractice, list => list === listName);    
    }
  }

  onGotoPractice() {
    this.route.navigate(['/training', 'practice', this.toPractice.join(';')])
  }
}
