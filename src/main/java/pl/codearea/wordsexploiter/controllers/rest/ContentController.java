package pl.codearea.wordsexploiter.controllers.rest;

import opennlp.tools.tokenize.TokenizerModel;
import org.apache.pdfbox.pdmodel.PDDocument;
import org.apache.pdfbox.text.PDFTextStripper;
import org.omg.CORBA.ServerRequest;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;
import pl.codearea.wordsexploiter.model.Content;
import pl.codearea.wordsexploiter.model.entity.Book;
import pl.codearea.wordsexploiter.model.entity.Page;
import pl.codearea.wordsexploiter.repository.BookRepository;
import pl.codearea.wordsexploiter.repository.BookSummary;

import java.io.IOException;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.TreeMap;
import java.util.regex.Pattern;
import java.util.stream.Collectors;
import java.util.stream.Stream;

/**
 * Created by kisilko on 01.07.17.
 */
@RestController
@RequestMapping("/api")
public class ContentController {

    @Autowired
    private Content content;

    @GetMapping("/content/{id}")
    public Book getContent(@PathVariable Integer id) {
        return content.findById(id);
    }

    @GetMapping("/list-content")
    public List<BookSummary> listContent() {
        return content.getAll();
    }

    @PostMapping("/new-content")
    public String handleFileUpload(@RequestParam("file") MultipartFile file) throws IOException {
        System.out.println("file upload");
        PDDocument document = PDDocument.load(file.getInputStream());
        content.addPDDocument(document);
//
//        Path tokenBinPath = Paths.get("src/main/nlpmodels/en-token.bin").toAbsolutePath();
//        TokenizerModel tokenModel = new TokenizerModel(tokenBinPath);

        return null;

//        PdfReader pdfReader = new PdfReader(file.getInputStream());
//        PdfDocument pdfDocument = new PdfDocument(pdfReader);
//        String text = PdfTextExtractor.getTextFromPage(pdfDocument.getPage(50));
//        System.out.println(text);
//        System.out.println(pdfDocument.getNumberOfPages());
    }

    @PostMapping("/delete-content/{id}")
    public void deleteContent(@PathVariable("id") Integer id) {
        content.delete(id);
    }
}
